generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  directUrl = env("DIRECT_URL")
  url       = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  USER
}

model Users {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  cpf       String?  @unique
  phone     String?  @unique
  picture   String?
  password  String?
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  categories Categories[]
  accounts   Accounts[]
  feedbacks  Feedbacks[]

  @@map("users")
}

enum CategoryType {
  EXPENSE
  INCOME
  ACCOUNT
}

model Categories {
  id     Int          @id @default(autoincrement())
  userId Int?
  name   String
  icon   String
  type   CategoryType

  user Users? @relation(fields: [userId], references: [id])

  budgets      Budgets[]
  accounts     Accounts[]
  transactions Transactions[]

  @@map("categories")
}

model Accounts {
  id         Int    @id @default(autoincrement())
  userId     Int
  categoryId Int
  name       String
  bank       String

  user     Users      @relation(fields: [userId], references: [id])
  category Categories @relation(fields: [categoryId], references: [id])

  budgets      Budgets[]
  transactions Transactions[]

  @@map("accounts")
}

enum RecurrenceEnum {
  NONRECURRING
  INSTALLMENT
  FIXEDMONTHLY
}

model Transactions {
  id                Int            @id @default(autoincrement())
  accountId         Int
  categoryId        Int
  title             String
  value             Decimal        @db.Decimal(9, 2)
  date              DateTime       @default(now())
  paid              Boolean        @default(false)
  recurrence        RecurrenceEnum @default(NONRECURRING)
  totalInstallments Int?

  account  Accounts   @relation(fields: [accountId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  category Categories @relation(fields: [categoryId], references: [id])

  installments Installments[]

  @@map("transactions")
}

model Installments {
  id                 Int      @id @default(autoincrement())
  transactionId      Int
  currentInstallment Int
  value              Decimal  @db.Decimal(9, 2)
  date               DateTime
  paid               Boolean  @default(false)

  transaction Transactions @relation(fields: [transactionId], references: [id])

  @@map("installments")
}

model Feedbacks {
  id     Int     @id @default(autoincrement())
  userId Int     @unique
  value  Boolean

  user Users @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())

  @@map("feedbacks")
}

model Budgets {
  id         Int      @id @default(autoincrement())
  accountId  Int
  categoryId Int
  title      String
  value      Decimal  @db.Decimal(9, 2)
  date       DateTime @default(now())

  account  Accounts   @relation(fields: [accountId], references: [id])
  category Categories @relation(fields: [categoryId], references: [id])

  @@map("budgets")
}
